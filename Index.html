<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Resource Dashboard</title>
    <!-- 1. Include Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 3. Include three.js and OrbitControls for 3D Viewer -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <!-- 4. Configure Tailwind to use the 'Inter' font -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    <style>
        /* Ensure the 3D canvas fills its container */
        #3dviewer {
            width: 100%;
            height: 100%;
            display: block;
            border-radius: 0.75rem; /* rounded-xl */
        }
        /* Simple loading text for 3D viewer */
        #3d-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.125rem; /* text-lg */
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <div class="container mx-auto p-4 md:p-8">
        
        <!-- Dashboard Header -->
        <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">
                Project Resource Dashboard
            </h1>
            <p class="text-lg text-gray-600 mt-1">
                An overview of team availability, project pipeline, and stake.
            </p>

            <!-- Control Bar -->
            <div class="mt-6 p-4 bg-white rounded-xl shadow-lg border border-gray-200 flex flex-wrap gap-4 items-center">
                
                <!-- Person Selector -->
                <div>
                    <label for="personSelect" class="block text-sm font-medium text-gray-700">Filter by Person</label>
                    <select id="personSelect" name="personSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                        <option>All People</option>
                        <option>Person A</option>
                        <option>Person B</option>
                        <option>Person C</option>
                        <option>Person D</option>
                        <option>Person E</option>
                        <option>Person F</option>
                    </select>
                </div>

                <!-- Project Selector -->
                <div>
                    <label for="projectSelect" class="block text-sm font-medium text-gray-700">Filter by Project</label>
                    <select id="projectSelect" name="projectSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md shadow-sm">
                        <option>All Projects</option>
                        <option>Project 1</option>
                        <option>Project 2</option>
                        <option>Project 3</option>
                    </select>
                </div>

                <!-- Spacer -->
                <div class="flex-grow"></div>

                <!-- Excel/CSV Controls -->
                <div class="flex gap-3">
                    <input type="file" id="csvImport" class="hidden" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
                    
                    <button id="importButton" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Import
                    </button>
                    
                    <button id="exportButton" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Export
                    </button>
                </div>
            </div>
        </header>

        <!-- Dashboard Grid (Updated to 2x2 on large screens) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">

            <!-- Chart 1: Individual Resource Availability (Bar Chart) -->
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">
                    Individual Resource Availability
                </h2>
                <div class="h-80 md:h-96"> <!-- Set a fixed height for the canvas container -->
                    <canvas id="availabilityChart"></canvas>
                </div>
            </div>

            <!-- Chart 2: Project Resources - 6 Months (Stacked Bar Chart) -->
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">
                    6-Month Resource Outlook (in Weeks)
                </h2>
                <div class="h-80 md:h-96"> <!-- Set a fixed height for the canvas container -->
                    <canvas id="outlookChart"></canvas>
                </div>
            </div>

            <!-- 3D Model Viewer -->
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">
                    3D Urban Massing
                </h2>
                <div class="h-80 md:h-96 bg-gray-800 rounded-xl overflow-hidden relative">
                    <div id="3d-loading">Loading 3D model...</div>
                    <canvas id="3dviewer"></canvas>
                </div>
            </div>

            <!-- Chart 3: Project Breakdown by Stake (Pie Chart) -->
            <div class="bg-white p-6 md:p-8 rounded-xl shadow-lg border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">
                    Project Breakdown by Stake
                </h2>
                <div class="h-80 md:h-96 w-full max-w-sm mx-auto"> <!-- Constrain pie chart size -->
                    <canvas id="stakeholderChart"></canvas>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- Chart & 3D Model Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Chart 1: Individual Resource Availability (Bar) ---
            try {
                const ctx1 = document.getElementById('availabilityChart').getContext('2d');
                if (ctx1) {
                    new Chart(ctx1, {
                        type: 'bar',
                        data: {
                            labels: ['Person A', 'Person B', 'Person C', 'Person D', 'Person E', 'Person F'],
                            datasets: [{
                                label: 'Availability (%)',
                                data: [80, 60, 100, 75, 90, 40],
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    ticks: {
                                        callback: function(value) {
                                            return value + '%';
                                        }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return ` ${context.dataset.label}: ${context.parsed.y}%`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (e) {
                console.error("Failed to load Availability Chart:", e);
            }

            // --- Chart 2: 6-Month Resource Outlook (Stacked Bar) ---
            try {
                const ctx2 = document.getElementById('outlookChart').getContext('2d');
                if (ctx2) {
                    const months = [];
                    const today = new Date();
                    for (let i = 0; i < 6; i++) {
                        const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
                        months.push(d.toLocaleString('default', { month: 'short' }));
                    }
                    new Chart(ctx2, {
                        type: 'bar',
                        data: {
                            labels: months,
                            datasets: [
                                {
                                    label: 'Confirmed Work',
                                    data: [20, 25, 30, 35, 40, 40],
                                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                                    borderColor: 'rgba(75, 192, 192, 1)',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Potential Work',
                                    data: [15, 10, 10, 5, 5, 10],
                                    backgroundColor: 'rgba(255, 159, 64, 0.6)',
                                    borderColor: 'rgba(255, 159, 64, 1)',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { stacked: true },
                                y: {
                                    stacked: true,
                                    beginAtZero: true,
                                    title: { display: true, text: 'Resource Weeks' }
                                }
                            },
                            plugins: {
                                legend: { position: 'top' }
                            }
                        }
                    });
                }
            } catch (e) {
                console.error("Failed to load Outlook Chart:", e);
            }

            // --- Chart 3: Project Breakdown by Stake (Pie) ---
            try {
                const ctx3 = document.getElementById('stakeholderChart').getContext('2d');
                if (ctx3) {
                    new Chart(ctx3, {
                        type: 'pie',
                        data: {
                            labels: ['Engineering', 'Marketing', 'Sales', 'Product', 'Support'],
                            datasets: [{
                                label: 'Project Stake',
                                data: [30, 20, 15, 25, 10],
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0.7)',
                                    'rgba(54, 162, 235, 0.7)',
                                    'rgba(255, 206, 86, 0.7)',
                                    'rgba(75, 192, 192, 0.7)',
                                    'rgba(153, 102, 255, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
